<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>COVID-19 by Country and Territory</title>
    <link href="https://unpkg.com/bootstrap@4.4.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://use.fontawesome.com/releases/v5.12.1/css/all.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.css" rel="stylesheet">
    <style>
        
    </style>
</head>
<body>
    <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
  
    <title> NEWS Covid-19</title>
  
    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  
      <link href="https://fonts.googleapis.com/css2?family=Baloo+Paaji+2:wght@600&display=swap" rel="stylesheet" >
    <!-- Custom styles for this template-->
    <link href="css/sb-admin-2.min.css" rel="stylesheet">
    
  </head>
  
  <body id="page-top">
   
    <!-- Page Wrapper -->
    <div id="wrapper">
  
      <!-- Sidebar -->
      <ul class="navbar-nav bg-dark sidebar sidebar-dark accordion" id="accordionSidebar">
  
        <!-- Sidebar - Brand -->
        <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
          <div class="sidebar-brand-icon rotate-n-15">
            <svg class="bi bi-exclamation-triangle-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M8.982 1.566a1.13 1.13 0 00-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5a.905.905 0 00-.9.995l.35 3.507a.552.552 0 001.1 0l.35-3.507A.905.905 0 008 5zm.002 6a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div class="sidebar-brand-text mx-4" >NEWS Covid-19 <sup></sup></div>
        </a>
  
        <!-- Divider -->
        <hr class="sidebar-divider my-0">
  
        <!-- Nav Item - Dashboard -->
        <li class="nav-item active">
          <a class="nav-link" href="index.html">
            <svg class="bi bi-house-fill" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M8 3.293l6 6V13.5a1.5 1.5 0 01-1.5 1.5h-9A1.5 1.5 0 012 13.5V9.293l6-6zm5-.793V6l-2-2V2.5a.5.5 0 01.5-.5h1a.5.5 0 01.5.5z" clip-rule="evenodd"/>
              <path fill-rule="evenodd" d="M7.293 1.5a1 1 0 011.414 0l6.647 6.646a.5.5 0 01-.708.708L8 2.207 1.354 8.854a.5.5 0 11-.708-.708L7.293 1.5z" clip-rule="evenodd"/>
            </svg>
            <span class="text-warning" >หน้าหลัก</span></a>
        </li>
  
        <!-- Divider -->
        <hr class="sidebar-divider">
  
  
  
  
  
        <!-- Nav Item - Pages Collapse Menu -->
        <li class="nav-item">
          <a class="nav-link collapsed" href="survey.html">
            <i class="fas fa-fw fa-folder"></i>
            <span class="text-warning">Self Assessment</span>
          </a>
  
        </li>
        <li class="nav-item">
            <a class="nav-link collapsed" href="bar-chart.html">
              <i class="fas fa-fw fa-folder"></i>
              <span class="text-warning">Chart</span>
            </a>
    
          </li>
  
        <!-- Divider -->
        <hr class="sidebar-divider d-none d-md-block">
  
        <!-- Sidebar Toggler (Sidebar) -->
        <div class="text-center d-none d-md-inline">
          <button class="rounded-circle border-0" id="sidebarToggle"></button>
        </div>
  
      </ul>
      <!-- End of Sidebar -->
  
      <!-- Content Wrapper -->
      <div id="content-wrapper" class="d-flex flex-column">
  
        <!-- Main Content -->
        <div id="content">
  
          <!-- Topbar -->
          <nav class="navbar navbar-expand navbar-light bg-dark topbar mb-4 static-top shadow">
  
            <!-- Sidebar Toggle (Topbar) -->
            <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
              <i class="fa fa-bars"></i>
            </button>
  
  
            <!-- Topbar Navbar -->
            <ul class="navbar-nav ml-auto">
  
  
              <!-- Nav Item - User Information -->
              <li class="nav-item dropdown no-arrow">
                <a class="nav-link dropdown-toggle" href="about.html">
                  <span class="mr-2 d-none d-lg-inline text-gray-600 small">About</span>
                  <img class="img-profile rounded-circle" src="https://uppic.cc/d/6pq8">
                </a>
  
              </li>
  
            </ul>
  
          </nav>
    <div class="container-fluid my-3">
        <div class="row">
            <div class="col-4 mr-auto form-group">
                <select id="country" class="form-control"></select>
            </div>
        </div>
        <div class="card card-body">
            <canvas id="myChart" style="width:100%; height:500px;"></canvas>
        </div>
    </div>

    <script src="https://unpkg.com/jquery@3.4.1/dist/jquery.min.js"></script>
    <script src="https://unpkg.com/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/bootstrap@4.4.1/dist/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.24.0/min/moment.min.js"></script> <!-- moment-with-locales.min.js -->
    <!-- github.com/chartjs/Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script> <!-- Chart.bundle.min.js -->
    <script>
        var covidstatus = [
            {title: 'Death Toll', slug: 'deaths', backgroundColor: '#ffcf9f', borderColor: '#ff9f40'}, 
            {title: 'Recoveries', slug: 'recovered', backgroundColor: '#a4dfdf', borderColor: '#4bc0c0'},
            {title: 'Confirmed Infections', slug: 'confirmed', backgroundColor: '#ffb0c1', borderColor: '#ff6384'}
        ];
        
        $('#country').html('<option disabled selected>-- Select country or region --</option>');
        axios.get('https://api.covid19api.com/countries').then(function(res) {
            res.data.forEach(function(row) {
                $('#country').append('<option value="'+row.Slug+'">'+row.Country+'</option>');
            });
        });
        
        var store = localStorage;
        var getStore = store.getItem('myCountry') ? store.getItem('myCountry') : 'italy';
        
        var mychart = myChart();
        countryData(getStore, covidstatus, mychart);
        
        $('#country').on('change', function() {
            store.setItem('myCountry', $(this).val());
            window.location.reload();
        });
        
        function countryData(country, status, chart) {
            getLabelData(chart);
            status.forEach(function(item, index) {
                getCountryData(item.slug, country, chart, index);
            });
        }
        
        function getLabelData(chart) {
            axios.get('https://api.covid19api.com/total/country/italy/status/confirmed').then(function(response) {
                chart.data.labels = formatData(response.data, 'label');
                chart.update();
            })
        }
        
        function getCountryData(status, country, chart, index) {
            axios.get('https://api.covid19api.com/total/country/'+country+'/status/'+status).then(function(response) {
                chart.data.datasets[index].data = formatData(response.data, 'data');
                chart.update();
            }).catch(function(error) {
                console.log(error);
            });
        }
        
        function formatData(data, type) {
            var list = [];
            data.forEach(function(item) {
                if(type == 'data') {
                    list.push(item.Cases);
                } else if(type == 'label') {
                    list.push(new Date(item.Date).getDate());
                }
            });
            return list.slice(data.length - 7, data.length);
        }
        
        function myChart() {
            var myBasicChart = new Chart('myChart', {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: dataSets(covidstatus)
                },
                options: {
			        responsive: true,
			        title: {
				        display: true,
				        text: 'COVID-19 by Country and Territory'
			        },
				    tooltips: {
					    mode: 'index',
					    intersect: true,
				    },
                    scales: {
                        xAxes: [{
					        display: true,
				        }],
				        yAxes: [{
					        display: true,
				        }]
                    }
                }
            });
            return myBasicChart;
        }
        
        function dataSets(data) {
            var sets = [];
            data.forEach(function(item) {
                sets.push({
                    label: item.title,
                    data: [],
                    backgroundColor: item.backgroundColor,
                    borderColor: item.borderColor,
                    borderWidth: 3,
                    fill: true
                });
            });
            return sets;
        }
    </script>
</body>
</html>
